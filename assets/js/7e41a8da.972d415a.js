"use strict";(self.webpackChunkevent_reservation_app_docs=self.webpackChunkevent_reservation_app_docs||[]).push([[1812],{8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}},9189:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"backend/Features/feature-Reservation/database","title":"02-database","description":"Archivo: 02-database.md","source":"@site/docs/backend/Features/06-feature-Reservation/02-database.md","sourceDirName":"backend/Features/06-feature-Reservation","slug":"/backend/Features/feature-Reservation/database","permalink":"/EventResourceReservationAppDocs/docs/backend/Features/feature-Reservation/database","draft":false,"unlisted":false,"editUrl":"https://github.com/jose-angell/EventResourceReservationAppDocs/docs/backend/Features/06-feature-Reservation/02-database.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"02-database"},"sidebar":"backendSidebar","previous":{"title":"01-overview","permalink":"/EventResourceReservationAppDocs/docs/backend/Features/feature-Reservation/overview"},"next":{"title":"03-endpoints","permalink":"/EventResourceReservationAppDocs/docs/backend/Features/feature-Reservation/endpoints"}}');var r=t(4848),a=t(8453);const s={sidebar_position:2,title:"02-database"},o="\ud83d\udce6 Modelo de datos",d={},c=[{value:"1. Entidades nuevas o modificadas",id:"1-entidades-nuevas-o-modificadas",level:2},{value:"Opci\xf3n B: Definici\xf3n con Clases de C# (EF Core Entities)",id:"opci\xf3n-b-definici\xf3n-con-clases-de-c-ef-core-entities",level:3},{value:"2. Migraciones de Base de Datos",id:"2-migraciones-de-base-de-datos",level:2},{value:"3. Relaciones e \xcdndices",id:"3-relaciones-e-\xedndices",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-modelo-de-datos",children:"\ud83d\udce6 Modelo de datos"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Archivo:"})," ",(0,r.jsx)(n.code,{children:"02-database.md"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Este documento describe las ",(0,r.jsx)(n.strong,{children:"entidades, tablas, migraciones y relaciones"})," de base de datos asociadas a la implementaci\xf3n de esta feature, asegurando la consistencia y la trazabilidad de los cambios en el esquema."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-entidades-nuevas-o-modificadas",children:"1. Entidades nuevas o modificadas"}),"\n",(0,r.jsx)(n.p,{children:"Definicion de las entidades de dominio y su mapeo a la base de datos (tablas, agregados). Se decidio utiliar un Id de tipo GUID para las reservaciones."}),"\n",(0,r.jsx)(n.h3,{id:"opci\xf3n-b-definici\xf3n-con-clases-de-c-ef-core-entities",children:"Opci\xf3n B: Definici\xf3n con Clases de C# (EF Core Entities)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c#",children:'namespace ResourceReservationApp.Domain.Entities\r\n{\r\n     public class Reservation\r\n{\r\n    public Guid Id { get; set; }\r\n    public DateTime StartTime { get; set; }\r\n    public DateTime EndTime { get; set; }\r\n    public int StatusId { get; set; }\r\n    public decimal TotalAmount { get; set; }\r\n    public string ClientComment { get; set; }\r\n    public string ClientPhoneNumber { get; set; }   \r\n    public int LocationId { get; set; }\r\n    public Location? Location { get; set; }\r\n    public Guid ClientId { get; set; }\r\n    public ApplicationUser? Client { get; set; }\r\n    public DateTime CreatedAt { get; set; }\r\n    public Guid? AdminId { get; set; }\r\n    public ApplicationUser? Admin { get; set; }\r\n    public string? AdminComment { get; set; }\r\n    public Guid? TransactionId { get; set; }\r\n    //public ICollection<ReservationDetail? ReservationDetail { get; set; }\r\n    public Reservation()\r\n    {\r\n        ClientComment = string.Empty;\r\n        ClientPhoneNumber = string.Empty;\r\n        AdminComment = string.Empty;\r\n    }\r\n    public Reservation(DateTime startTime, DateTime endTime, int statusId, decimal totalAmount, \r\n        string? clientComment, string clientPhoneNumber, int locationId, Guid clientId)\r\n    {\r\n        if(startTime >= endTime)\r\n        {\r\n            throw new ArgumentException("StartTime must be earlier than EndTime.", nameof(startTime));\r\n        }\r\n        if( statusId <= 0)\r\n        {\r\n            throw new ArgumentException("StatusId cannot be empty.", nameof(statusId));\r\n        }\r\n        if(totalAmount <= 0)\r\n        {\r\n            throw new ArgumentException("TotalAmount must be a positive value.", nameof(totalAmount));\r\n        }\r\n        if (string.IsNullOrWhiteSpace(clientPhoneNumber))\r\n        {\r\n            throw new ArgumentException("ClientPhoneNumber cannot be null or empty.", nameof(clientPhoneNumber));\r\n        }\r\n        if (locationId == 0)\r\n        {\r\n            throw new ArgumentException("LocationId cannot be empty.", nameof(locationId));\r\n        }\r\n        if (clientId == Guid.Empty)\r\n        {\r\n            throw new ArgumentException("ClientId cannot be empty.", nameof(clientId));\r\n        }\r\n        StartTime = startTime;\r\n        EndTime = endTime;\r\n        StatusId = statusId;\r\n        TotalAmount = totalAmount;\r\n        ClientComment = clientComment ?? string.Empty;\r\n        ClientPhoneNumber = clientPhoneNumber;\r\n        LocationId = locationId;\r\n        ClientId = clientId;\r\n        AdminComment = string.Empty;\r\n        CreatedAt = DateTime.UtcNow;\r\n    }\r\n    public void Update(DateTime startTime, DateTime endTime, int statusId, decimal totalAmount,\r\n        string clientComment, string clientPhoneNumber, int locationId)\r\n    {\r\n        if (startTime >= endTime)\r\n        {\r\n            throw new ArgumentException("StartTime must be earlier than EndTime.", nameof(startTime));\r\n        }\r\n        if (statusId <= 0)\r\n        {\r\n            throw new ArgumentException("StatusId cannot be empty.", nameof(statusId));\r\n        }\r\n        if (totalAmount <= 0)\r\n        {\r\n            throw new ArgumentException("TotalAmount must be a positive value.", nameof(totalAmount));\r\n        }\r\n        if (string.IsNullOrWhiteSpace(clientPhoneNumber))\r\n        {\r\n            throw new ArgumentException("ClientPhoneNumber cannot be null or empty.", nameof(clientPhoneNumber));\r\n        }\r\n        if (locationId == 0)\r\n        {\r\n            throw new ArgumentException("LocationId cannot be empty.", nameof(locationId));\r\n        }\r\n        StartTime = startTime;\r\n        EndTime = endTime;\r\n        StatusId = statusId;\r\n        TotalAmount = totalAmount;\r\n        ClientComment = clientComment ?? string.Empty;\r\n        ClientPhoneNumber = clientPhoneNumber;\r\n        LocationId = locationId;\r\n    }\r\n    public void UpdateStatus(int statusId, Guid adminId, string adminComment)\r\n    {\r\n        if (statusId <= 0)\r\n        {\r\n            throw new ArgumentException("StatusId cannot be empty.", nameof(statusId));\r\n        }\r\n        if (adminId == Guid.Empty)\r\n        {\r\n            throw new ArgumentException("AdminId cannot be empty.", nameof(adminId));\r\n        }\r\n        StatusId = statusId;\r\n        AdminId = adminId;\r\n        AdminComment = adminComment ?? string.Empty;\r\n    }\r\n    public void UpdateTransaction(int statusId, Guid adminId, string adminComment, Guid transactionId)\r\n    {\r\n        if (statusId <= 0)\r\n        {\r\n            throw new ArgumentException("StatusId cannot be empty.", nameof(statusId));\r\n        }\r\n        if (adminId == Guid.Empty)\r\n        {\r\n            throw new ArgumentException("AdminId cannot be empty.", nameof(adminId));\r\n        }\r\n        if (transactionId == Guid.Empty)\r\n        {\r\n            throw new ArgumentException("TransactionId cannot be empty.", nameof(transactionId));\r\n        }\r\n        StatusId = statusId;\r\n        AdminId = adminId;\r\n        AdminComment = adminComment ?? string.Empty;\r\n        TransactionId = transactionId;\r\n    }\r\n\r\n}\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"2-migraciones-de-base-de-datos",children:"2. Migraciones de Base de Datos"}),"\n",(0,r.jsx)(n.p,{children:"Lista todas las migraciones de EF Core creadas o modificadas para esta feature."}),"\n",(0,r.jsx)(n.h2,{id:"3-relaciones-e-\xedndices",children:"3. Relaciones e \xcdndices"}),"\n",(0,r.jsx)(n.p,{children:"Documenta las relaciones entre tablas (claves for\xe1neas) y los \xedndices creados para optimizar el rendimiento de las consultas y asegurar la integridad de los datos."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Columna"}),(0,r.jsxs)(n.th,{children:["Tipo Tipo / Cardinalidad ",(0,r.jsx)("br",{})," (FK/INDEX)"]}),(0,r.jsx)(n.th,{children:"Columna Destino (si es FK)"}),(0,r.jsx)(n.th,{children:"Prop\xf3sito / Justificaci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<Resource>.<CreatedByUserId>"})}),(0,r.jsx)(n.td,{children:"FK"}),(0,r.jsx)(n.td,{children:"User(Id)"}),(0,r.jsx)(n.td,{children:"Integridad referencial: Asegura que una reserva tenga un responsable."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<Resource>.<TransactionId>"})}),(0,r.jsx)(n.td,{children:"FK"}),(0,r.jsx)(n.td,{children:"Category(Id)"}),(0,r.jsx)(n.td,{children:"Integridad referencial: Asegura que una reservacion tenga un pago relacionado."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<Resource>.<LocationId>"})}),(0,r.jsx)(n.td,{children:"FK"}),(0,r.jsx)(n.td,{children:"Location(Id)"}),(0,r.jsx)(n.td,{children:"Integridad referencial: Asegura que una reservacion tenga una ubicacion."})]})]})]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);